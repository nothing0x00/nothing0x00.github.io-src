Title: Walkthrough: Sunrise CTF
Date: 2020-03-04
Tags: #CTF
Category: CTF
Slug: sunrise
Authors: nothing0x00
Summary: Walkthrough for the Sunrise CTF

The Sunrise CTF machine is the third in a series, two of which (Dusk and Nightfall) have already been discussed on this blog.

Let's get this party started!

Upon launch the machine was allocated 192.168.56.109 in the host-only DHCP.  Initial scanning shows the machine has ports 22,80,3306 and 8080 open.

![initial_nmap](/images/sunrise/initial_nmap.png)

The SSH service on port 22 and the nginx server on port 80 seem, at first glance to be uninteresting. The MariaDB server on port 3306 blocks connections from the attacking machine IP.

The service on port 8080, however, seems to be the initial point of ingress. It is a Weborf server, with some interesting results being generated by nmap testing scripts.

![weborf](/images/sunrise/weborf.png)

Within these results there are indications of a possible path traversal vulnerability, an exposed /html/ folder which may allow for assistance in navigation and indications that the server is using DAV with risky HTTP verbs, which may allow for a shell upload.

A quick search online confirms that the version of Weborf, 0.12.2, is vulnerable to path traversal. The exploit is explained at the link below:

https://www.exploit-db.com/exploits/14925

This vulnerability, due to the structure of the Weborf server, which is meant to share directories, allows for accessing directories and getting a directory listing. After accessing the /etc/passwd file two users were identified, weborf and sunrise.

![etc_passwd](/images/sunrise/etc_passwd.png)

Using this method the /home/sunrise directory was accessed.

![home_sunrise](/images/sunrise/home_sunrise.png)

From here the user.txt file was accessed.

![user_flag](/images/sunrise/user_flag.png)

Next, the /home/weborf directory was accessed using the same method.

![home_weborf](/images/sunrise/home_weborf.png)

The primary flaw of this method is that hidden files and directories are not displayed in the UI upon exploitation, but the contents will be displayed if called directly. To address this situation I grabbed a list of common hidden files from FuzzDB (UnixDotFiles) and deleted the leading / from each entry, then used ZAP (no Burp Pro on this machine) to fuzz for the files. This method identified the .mysql_history, .bashrc and .profile files, all of which are accessible through the UI.

![found_files](/images/sunrise/found_files.png)

In the .mysql_history file there is an entry which reveals credentials; weborf@localhost:iheartrainbows44

![mysql_history](/images/sunrise/mysql_history.png)

The MariaDB database is still rejecting the connection, so the next step is to use the creds to log in over ssh.

![weborf_ssh](/images/sunrise/weborf_ssh.png)

After initial enumeration turned up nothing of substance, the login credentials for weborf were used to log into the database. In the database, in the mysql database's user table, were cleartext credentials for the sunrise user; sunrise:thefutureissobrightigottawearshades.

![sunrise_creds](/images/sunrise/sunrise_creds.png)

These credentials were then used to log in through SSH.

![sunrise_ssh](/images/sunrise/sunrise_ssh.png)

After logging in enumeration revealed that sunrise can only run the wine command as root with sudo.

![sudo_wine](/images/sunrise/sudo_wine.png)

To elevate to root the first step is to generate an executable payload to run through wine. For this purposes msfvenom will be used in this context.

![msfvenom](/images/sunrise/msfvenom.png)

A Metasploit payload handler is then configured and executed.

![handler](/images/sunrise/handler.png)

A Python HTTP Server was started and the file was downloaded into /tmp on the target machine using wget.

![wget](/images/sunrise/wget.png)

Finally the payload was run using sudo wine.

![payload_run](/images/sunrise/payload_run.png)

The payload executes and the reverse shell is then caught by the handler, giving a Meterpreter shell running as root on the target machine.

![shell_connect](/images/sunrise/shell_connect.png)

The root.txt file is then downloaded back to the attacking machine and displayed to the screen.

![root_flag](/images/sunrise/root_flag.png)

![root_display](/images/sunrise/root_display.png)
